<!doctype html>
<html>
<head>
  <meta charset="UTF-8">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Weekly Work</title>

  <!--CSS-->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  <link href="http://necolas.github.io/normalize.css/3.0.2/normalize.css" rel="stylesheet" />
  <link href="/css/style.css" rel="stylesheet" />
  <link href="/css/header.css" rel="stylesheet" />

  <!--fonts-->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />

  <!--scripts-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

</head>
<header>
    <% include header %>
</header>
<body>

<div class="row">
        <div class="col-sm-6 col-sm-offset-3">
        <% if (typeof message != 'undefined' && message == 'Unable to send email') {  %>
                <div class="alert alert-danger"><%= message %></div>
            <% } else if (typeof message != 'undefined' && message == 'Email Sent!'){ %>
                <div class="alert alert-success"><%= message %></div>
            <% } %>
        </div>
    </div>

<div class="customers">
  <div class="header">
    <h1 id="week">March Billing Statements</h1>
  </div>
  <div class="left">
    <% for(var i=0; i<customers.length; i++) { %>
        <div id="info">
            <div class="test" id="billInfo"></div>
           <script>
              $(document).ready(function(){
                var divNum = "<%= i %>";

                var name = "<%= customers[i].name %>";
                var address = "<%= customers[i].address %>";
                var email = "<%= customers[i].email %>"; 
                var temp = "<%= customers[i].sDate %>";
                var date = new Date(temp.toString().replace( /(\d{2})\/(\d{2})\/(\d{4})/, "$1/$2/$3"));
                var twoWeek = date;
                var beginDate = new Date("2/15/2016");
                var endDate = new Date("10/31/2016");
                var pretty;
                var dates = new Array();



                while(twoWeek > beginDate && twoWeek < endDate) {
                  twoWeek.setDate(date.getDate() + 14);
                  if(twoWeek > endDate) {
                    break;
                  } else {
                    pretty = twoWeek.toLocaleDateString();
                    dates.push(pretty);
                  }
                }

                var tempDiv = $('<div></div>');
                $('#billInfo').append(tempDiv);
                tempDiv.attr("id", divNum); 

                var tempName = $('<h1>' + name + '</h1>');
                $('#' + divNum + '').append(tempName);

                var tempEmail = $('<h3>' + email + '</h3>');
                $('#' + divNum + '').append(tempEmail);

                for(var i = 0; i< dates.length; i++) {
                  var toDate = new Date(dates[i]);

                  if(toDate.getMonth() == 2) {
                    var tempDate = $('<p>Service Date: ' + dates[i] + ' </p>')
                    $('#' + divNum + '').append(tempDate);
                  }
                }

                var tempButton = $('<button>Send Email</button>');
                $('#' + divNum + '').append(tempButton);


                var from, to, subject, text, name, services;

                $('#' + divNum + '  button').click(function() {
                  to = $('#' + divNum + '  h3').text();
                  name = $('#' + divNum + '  h1').text();
                  subject = "March Billing Statement - Grass Cutters";
                  services = $('#' + divNum + '  p').text();
                  text = "Hello " + name + ", here is your billing statement for the month of March: " + services;
                  
                });

              });
              /*$(".test").each(function(index) {
                $(this).attr("id", this.id + index);
                var name = "<%= customers[i].name %>";
                var address = "<%= customers[i].address %>";
                var email = "<%= customers[i].email %>"; 
                var temp = "<%= customers[i].sDate %>";
                var date = new Date(temp.toString().replace( /(\d{2})\/(\d{2})\/(\d{4})/, "$1/$2/$3"));
                var twoWeek = date;
                var beginDate = new Date("2/15/2016");
                var endDate = new Date("10/31/2016");
                var pretty;
                var dates = new Array();



                while(twoWeek > beginDate && twoWeek < endDate) {
                  twoWeek.setDate(date.getDate() + 14);
                  if(twoWeek > endDate) {
                    break;
                  } else {
                    pretty = twoWeek.toLocaleDateString();
                    dates.push(pretty);
                  }
                }

                var tempName = $('<h1>' + name +'</h1>');
                $('#billInfo' + index + '').append(tempName);
                tempName.attr("id", index);

                $('#billInfo' + index + '').append('<h3>' + email + '</h3>');

                var TEST = new Date(dates[0]);

                for(var i = 0; i< dates.length; i++) {
                  var toDate = new Date(dates[i]);

                  if(toDate.getMonth() == 2) {
                    $('#billInfo' + index + '').append('<p>Service Date: ' + dates[i] + '</p>');
                  }
                }

                $('#billInfo' + index + '').append('<button>Send Email</button>');

                
                var from, to, subject, text, name;

                $('#billInfo' + index + ' button').click(function() {
                  name = $("p").val();
                  alert(name);
                });



                //while(dates[0] <= billDates[0]) {
                  //$('#billInfo' + index + '').append('<h1>' + billDates[0] + ' ' + dates[0] + '</h1>');
                     //dates.shift();
                //}
                /*
                for(var i = 0; i < billDates.length; i++) {
                  for(var j = 0; j < dates.length; j++) {
                    if(dates[j] < billDates[i]) {
                      $('#billInfo' + index + '').append('<h1>' + billDates[i] + ' ' + dates[j] + '</h1>');
                      dates.shift();
                    }
                  }
                }
                /*


                /*
                  create array of bill dates, similar to dates array and loop through, check if any dates in bill array are this week, if so print
                */

              //});
              </script>
        </div>
    <% } %>
    </div>
</div>
</body>
</html>